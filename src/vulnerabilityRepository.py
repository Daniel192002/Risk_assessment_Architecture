
from databaseManager import DatabaseManager
import json


class VulnerabilityRepository:
    def __init__(self, db_manager: DatabaseManager):
        self.db = db_manager

    def get_all_vulnerabilities(self):
        query = "SELECT ipv4, cve FROM vulnerabilities"
        return self.db.execute_query(query)

    def insert_vulnerability(self, mac, ipv4, cve, severity, nvt_name, solution):
        query = "INSERT INTO vulnerabilities (mac, ipv4, cve, severity, nvt_name, solution) VALUES (%s, %s, %s, %s, %s, %s)"
        self.db.execute_query(query, (mac, ipv4, cve, severity, nvt_name, solution))

    def cve_exists(self, ipv4, cve):
        query = "SELECT 1 FROM vulnerabilities WHERE ipv4 = %s AND cve = %s LIMIT 1"
        return self.db.execute_query(query, (ipv4, cve), fetch_one=True) is not None